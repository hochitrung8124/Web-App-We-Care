"KPI As screen.'tabletLayout_HeaderAndGallery_ver3.0'":
    Fill: =RGBA(214, 221, 224, 1)
    OnVisible: =

    RectQuickActionBar1 As rectangle:
        Fill: =RGBA(4, 161, 179, 1)
        Height: =72
        Width: =Parent.Width
        ZIndex: =1

    TitleKPI As label:
        Align: =Align.Center
        Font: =Font.Arial
        Height: =72
        PaddingRight: =10
        Size: =28
        Text: ="KPI"
        Width: =Parent.Width
        ZIndex: =2

    "'Gallery KPI' As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
        DelayItemLoading: =true
        Fill: =RGBA(214, 221, 224, 1)
        Height: =If(!check_role_sup, 1300, 1240)
        Items: =List_KPI
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplatePadding: =10
        TemplateSize: =112
        Width: =Parent.Width
        Y: =If(!check_role_sup, 72, 130)
        ZIndex: =3

        Button_Nền As button:
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(255, 255, 255, 1)
            Height: =112
            OnSelect: =Select(Parent)
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Text: =
            Width: =746
            ZIndex: =2

        "'Title KPI' As label":
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            OnSelect: =Select(Parent)
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =24
            Text: =If(ThisItem.Loai_doi_tuong="Tỉnh thành", ThisItem.Doi_Tuong & " - " & ThisItem.NameKPI, ThisItem.NameKPI)
            VerticalAlign: =VerticalAlign.Top
            Width: =Parent.Width-50
            Wrap: =false
            X: =10
            ZIndex: =3

        "'Subtitle Tần suất' As label":
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =36
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: =If( ThisItem.Tan_suat = "Tuần", "Tuần " & ThisItem.Tuan,"Tháng " & ThisItem.Thang)
            VerticalAlign: =VerticalAlign.Top
            Width: ='Title KPI'.Width
            X: =10
            Y: =53
            ZIndex: =4

        "'Subtitle KPI Value' As label":
            Align: =Align.Right
            BorderColor: =RGBA(0, 0, 0, 1)
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =Self.Size * 1.8
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =20
            PaddingTop: =0
            Size: =15
            Text: |
                =With(
                    {
                        actual: ThisItem.KPI_Actual,
                        target: ThisItem.KPI_Value
                    },
                    If(
                        actual < 1 And target < 1,
                        actual & " / " & target,
                        actual < 1,
                        actual & " / " & Text(target, "#,###"),
                        target < 1,
                        Text(actual, "#,###") & " / " & target,
                        Text(actual, "#,###") & " / " & Text(target, "#,###")
                    )
                )
            VerticalAlign: =VerticalAlign.Top
            Width: =300
            X: =448
            Y: ='Chart KPI'.Y + 'Chart KPI'.Height
            ZIndex: =6

        "'Subtitle KPI' As label":
            BorderColor: =RGBA(0, 0, 0, 1)
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =Self.Size * 1.8
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =20
            Text: ="KPI"
            VerticalAlign: =VerticalAlign.Top
            Width: ='Title KPI'.Width - 100
            X: =150
            Y: ='Subtitle Tần suất'.Y
            ZIndex: =7

        "'Chart KPI' As button":
            DisplayMode: =DisplayMode.View
            Fill: |
                =With(
                    { progress: If(ThisItem.KPI_Value > 0, ThisItem.KPI_Actual / ThisItem.KPI_Value, 0.5) },
                    With(
                        { percent: Min(progress * (Timer1.Value / Timer1.Duration) * 100, 100) },
                        If(
                            percent >= 100,
                            RGBA(50, 165, 64, 0.8), // Xanh
                            percent >= 50,
                            RGBA(255, 199, 0, 0.8), // Vàng
                            percent < 30,
                            RGBA(207, 60, 60, 0.8), // Đỏ
                            RGBA(255, 138, 0, 0.8)  // Cam (30–49%)
                        )
                    )
                )
            Font: =Font.Arial
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =Self.Size * 2
            OnSelect: =Select(Parent)
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Text: |
                =With(
                    { progress: If(ThisItem.KPI_Value > 0, ThisItem.KPI_Actual / ThisItem.KPI_Value, 0.5) },
                    With(
                        { animatedPercent: Min(Round(progress * (Timer1.Value / Timer1.Duration) * 100, 0), 100) },
                        animatedPercent & "%"
                    )
                )
            Width: |
                =With(
                    {
                        MaxWidth: 530,
                        progress: If(
                            ThisItem.KPI_Value > 0,
                            ThisItem.KPI_Actual / ThisItem.KPI_Value,
                            0.5
                        ),
                        animatedPercent: Min(Timer1.Value / Timer1.Duration, 1)
                    },
                    Min(MaxWidth * progress * animatedPercent, MaxWidth)
                )
            X: =199
            Y: ='Subtitle Tần suất'.Y
            ZIndex: =8

    "'Icon Back' As icon":
        Color: =RGBA(255, 255, 255, 1)
        Height: =60
        Icon: =Icon.ArrowLeft
        OnSelect: |
            =Back();
            Reset(Combobox_Sales);
        Width: =60
        X: =10
        Y: =12
        ZIndex: =4

    Combobox_Sales As Combobox.pcfdataset:
        BorderColor: =RGBA(0, 0, 0, 1)
        BorderStyle: =BorderStyle.Solid
        BorderThickness: =0
        DefaultSelectedItems: =nv_sale
        DisplayMode: =DisplayMode.Edit
        Font: =Font.Arial
        FontSize: =16
        FontWeight: =FontWeight.Normal
        Height: =41
        InputTextPlaceholder: ="Tên nhân viên"
        Items: =Sales_Manage
        OnChange: |
            =UpdateContext({autostart_Timer:false});
            UpdateContext({autostart_Timer:true});
        Visible: =check_role_sup
        Width: =400
        X: =360
        Y: =79
        ZIndex: =5

        crdfd_name1 As PowerApps_CoreControls_ComboboxCanvasTemplate_dataField.textualColumn:
            FieldDisplayName: ="crdfd_name"
            FieldName: ="crdfd_name"
            FieldType: ="s"
            FieldVariantName: ="textualColumn"
            Order: =1
            ZIndex: =9

    Timer1 As timer:
        AutoStart: =true
        Duration: =2000
        Start: =autostart_Timer
        Visible: =false
        X: =10
        Y: =100
        ZIndex: =6

