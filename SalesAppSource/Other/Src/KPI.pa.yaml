# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  KPI:
    Properties:
      Fill: =RGBA(214, 221, 224, 1)
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
    Children:
      - RectQuickActionBar1:
          Control: Rectangle@2.3.0
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Fill: =RGBA(4, 161, 179, 1)
            Height: =72
            Width: =Parent.Width
      - TitleKPI:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 0, 0, 1)
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Arial
            Height: =72
            PaddingRight: =10
            Size: =28
            Text: ="KPI"
            Width: =Parent.Width
      - Gallery KPI:
          Control: Gallery@2.15.0
          Variant: BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Fill: =RGBA(214, 221, 224, 1)
            Height: =If(!check_role_sup, 1300, 1240)
            Items: =List_KPI
            TemplatePadding: =10
            TemplateSize: =112
            Width: =Parent.Width
            Y: =If(!check_role_sup, 72, 130)
          Children:
            - Button_Nền:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =ColorFade(Self.Fill, -15%)
                  Color: =RGBA(255, 255, 255, 1)
                  DisabledBorderColor: =RGBA(166, 166, 166, 1)
                  DisplayMode: =DisplayMode.View
                  Fill: =RGBA(255, 255, 255, 1)
                  Font: =Font.'Open Sans'
                  Height: =112
                  HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                  HoverColor: =RGBA(255, 255, 255, 1)
                  HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                  OnSelect: =Select(Parent)
                  PressedBorderColor: =Self.Fill
                  PressedColor: =Self.Fill
                  PressedFill: =Self.Color
                  RadiusBottomLeft: =20
                  RadiusBottomRight: =20
                  RadiusTopLeft: =20
                  RadiusTopRight: =20
                  Text: =
                  Width: =746
            - Title KPI:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Color: =RGBA(50, 49, 48, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                  OnSelect: =Select(Parent)
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =24
                  Text: =If(ThisItem.Loai_doi_tuong="Tỉnh thành", ThisItem.Doi_Tuong & " - " & ThisItem.NameKPI, ThisItem.NameKPI)
                  VerticalAlign: =VerticalAlign.Top
                  Width: =Parent.Width-50
                  Wrap: =false
                  X: =10
            - Subtitle Tần suất:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                  Height: =36
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =20
                  Text: =If( ThisItem.Tan_suat = "Tuần", "Tuần " & ThisItem.Tuan,"Tháng " & ThisItem.Thang)
                  VerticalAlign: =VerticalAlign.Top
                  Width: ='Title KPI'.Width
                  X: =10
                  Y: =53
            - Subtitle KPI Value:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Right
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                  Height: =Self.Size * 1.8
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =20
                  PaddingTop: =0
                  Size: =15
                  Text: |
                    =With(
                        {
                            actual: ThisItem.KPI_Actual,
                            target: ThisItem.KPI_Value
                        },
                        If(
                            actual < 1 And target < 1,
                            actual & " / " & target,
                            actual < 1,
                            actual & " / " & Text(target, "#,###"),
                            target < 1,
                            Text(actual, "#,###") & " / " & target,
                            Text(actual, "#,###") & " / " & Text(target, "#,###")
                        )
                    )
                  VerticalAlign: =VerticalAlign.Top
                  Width: =300
                  X: =448
                  Y: ='Chart KPI'.Y + 'Chart KPI'.Height
            - Subtitle KPI:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                  Height: =Self.Size * 1.8
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =20
                  Text: ="KPI"
                  VerticalAlign: =VerticalAlign.Top
                  Width: ='Title KPI'.Width - 100
                  X: =150
                  Y: ='Subtitle Tần suất'.Y
            - Chart KPI:
                Control: Classic/Button@2.2.0
                Properties:
                  BorderColor: =ColorFade(Self.Fill, -15%)
                  Color: =RGBA(255, 255, 255, 1)
                  DisabledBorderColor: =RGBA(166, 166, 166, 1)
                  DisplayMode: =DisplayMode.View
                  Fill: |
                    =With(
                        { progress: If(ThisItem.KPI_Value > 0, ThisItem.KPI_Actual / ThisItem.KPI_Value, 0.5) },
                        With(
                            { percent: Min(progress * (Timer1.Value / Timer1.Duration) * 100, 100) },
                            If(
                                percent >= 100,
                                RGBA(50, 165, 64, 0.8), // Xanh
                                percent >= 50,
                                RGBA(255, 199, 0, 0.8), // Vàng
                                percent < 30,
                                RGBA(207, 60, 60, 0.8), // Đỏ
                                RGBA(255, 138, 0, 0.8)  // Cam (30–49%)
                            )
                        )
                    )
                  Font: =Font.Arial
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                  Height: =Self.Size * 2
                  HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                  HoverColor: =RGBA(255, 255, 255, 1)
                  HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                  OnSelect: =Select(Parent)
                  PressedBorderColor: =Self.Fill
                  PressedColor: =Self.Fill
                  PressedFill: =Self.Color
                  RadiusBottomLeft: =20
                  RadiusBottomRight: =20
                  RadiusTopLeft: =20
                  RadiusTopRight: =20
                  Text: |
                    =With(
                        { progress: If(ThisItem.KPI_Value > 0, ThisItem.KPI_Actual / ThisItem.KPI_Value, 0.5) },
                        With(
                            { animatedPercent: Min(Round(progress * (Timer1.Value / Timer1.Duration) * 100, 0), 100) },
                            animatedPercent & "%"
                        )
                    )
                  Width: |
                    =With(
                        {
                            MaxWidth: 530,
                            progress: If(
                                ThisItem.KPI_Value > 0,
                                ThisItem.KPI_Actual / ThisItem.KPI_Value,
                                0.5
                            ),
                            animatedPercent: Min(Timer1.Value / Timer1.Duration, 1)
                        },
                        Min(MaxWidth * progress * animatedPercent, MaxWidth)
                    )
                  X: =199
                  Y: ='Subtitle Tần suất'.Y
      - Icon Back:
          Control: Classic/Icon@2.5.0
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Color: =RGBA(255, 255, 255, 1)
            Height: =60
            Icon: =Icon.ArrowLeft
            OnSelect: |+
              =Back();
              Reset(Combobox_Sales);
            Width: =60
            X: =10
            Y: =12
      - Combobox_Sales:
          Control: ComboBox@0.0.51
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            BorderStyle: =BorderStyle.Solid
            BorderThickness: =0
            DefaultSelectedItems: =nv_sale
            Font: =Font.Arial
            FontSize: =16
            FontWeight: =FontWeight.Normal
            Height: =41
            InputTextPlaceholder: ="Tên nhân viên"
            Items: =Sales_Manage
            OnChange: |+
              =UpdateContext({autostart_Timer:false});
              UpdateContext({autostart_Timer:true});
            Visible: =check_role_sup
            Width: =400
            X: =360
            Y: =79
          Children:
            - crdfd_name1:
                Control: ComboBoxDataField@1.5.0
                Variant: textualColumn
                IsLocked: true
                Properties:
                  FieldDisplayName: ="crdfd_name"
                  FieldName: ="crdfd_name"
                  FieldType: ="s"
                  Order: =1
      - Timer1:
          Control: Timer@2.1.0
          Properties:
            AutoStart: =true
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: =2000
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =autostart_Timer
            Visible: =false
            X: =10
            Y: =100
